unit [0,0]
    function [0,753]
        type [0,3]
            name: int [0,3]
        name: tpm_open [4,12]
        parameter_list [12,52]
            parameter [13,32]
                decl [13,32]
                    type [13,32]
                        name [13,25]
                            name: struct [13,19]
                            name: inode [20,25]
                        modifier: * [26,27]
                    name: inode [27,32]
            parameter [34,51]
                decl [34,51]
                    type [34,51]
                        name [34,45]
                            name: struct [34,40]
                            name: file [41,45]
                        modifier: * [46,47]
                    name: file [47,51]
        block [53,753]
            block_content [56,751]
                decl_stmt [56,82]
                    decl [56,81]
                        type [56,59]
                            name: int [56,59]
                        name: minor [60,65]
                        init [66,81]
                            expr [68,81]
                                call [68,81]
                                    name: iminor [68,74]
                                    argument_list [74,81]
                                        argument [75,80]
                                            expr [75,80]
                                                name: inode [75,80]
                decl_stmt [84,119]
                    decl [84,112]
                        type [84,101]
                            name [84,99]
                                name: struct [84,90]
                                name: tpm_chip [91,99]
                            modifier: * [100,101]
                        name: chip [101,105]
                        init [106,112]
                            expr [108,112]
                                name: NULL [108,112]
                    decl [114,118]
                        type [84,101]
                            modifier: * [114,115]
                        name: pos [115,118]
                expr_stmt [122,138]
                    expr [122,137]
                        call [122,137]
                            name: rcu_read_lock [122,135]
                            argument_list [135,137]
                macro [140,190]
                    name: list_for_each_entry_rcu [140,163]
                    argument_list [163,190]
                        argument [164,167]
                        argument [169,183]
                        argument [185,189]
                block [191,294]
                    block_content [195,291]
                        if_stmt [195,291]
                            if [195,291]
                                condition [198,234]
                                    expr [199,233]
                                        name [199,224]
                                            name: pos [199,202]
                                            operator: -> [202,204]
                                            name: vendor [204,210]
                                            operator: . [210,211]
                                            name: miscdev [211,218]
                                            operator: . [218,219]
                                            name: minor [219,224]
                                        operator: == [225,227]
                                        name: minor [228,233]
                                block [235,291]
                                    block_content [240,287]
                                        expr_stmt [240,251]
                                            expr [240,250]
                                                name: chip [240,244]
                                                operator: = [245,246]
                                                name: pos [247,250]
                                        expr_stmt [255,277]
                                            expr [255,276]
                                                call [255,276]
                                                    name: get_device [255,265]
                                                    argument_list [265,276]
                                                        argument [266,275]
                                                            expr [266,275]
                                                                name [266,275]
                                                                    name: chip [266,270]
                                                                    operator: -> [270,272]
                                                                    name: dev [272,275]
                                        break [281,287]
                expr_stmt [296,314]
                    expr [296,313]
                        call [296,313]
                            name: rcu_read_unlock [296,311]
                            argument_list [311,313]
                if_stmt [317,345]
                    if [317,345]
                        condition [320,327]
                            expr [321,326]
                                operator: ! [321,322]
                                name: chip [322,326]
                        block [330,345]
                            block_content [330,345]
                                return [330,345]
                                    expr [337,344]
                                        operator: - [337,338]
                                        name: ENODEV [338,344]
                if_stmt [348,492]
                    if [348,492]
                        condition [351,388]
                            expr [352,387]
                                call [352,387]
                                    name: test_and_set_bit [352,368]
                                    argument_list [368,387]
                                        argument [369,370]
                                            expr [369,370]
                                                literal: 0 [369,370]
                                        argument [372,386]
                                            expr [372,386]
                                                operator: & [372,373]
                                                name [373,386]
                                                    name: chip [373,377]
                                                    operator: -> [377,379]
                                                    name: is_open [379,386]
                        block [389,492]
                            block_content [393,489]
                                expr_stmt [393,447]
                                    expr [393,446]
                                        call [393,446]
                                            name: dev_dbg [393,400]
                                            argument_list [400,446]
                                                argument [401,410]
                                                    expr [401,410]
                                                        name [401,410]
                                                            name: chip [401,405]
                                                            operator: -> [405,407]
                                                            name: dev [407,410]
                                                argument [412,445]
                                                    expr [412,445]
                                                        literal: "Another process owns this TPM\n" [412,445]
                                expr_stmt [450,472]
                                    expr [450,471]
                                        call [450,471]
                                            name: put_device [450,460]
                                            argument_list [460,471]
                                                argument [461,470]
                                                    expr [461,470]
                                                        name [461,470]
                                                            name: chip [461,465]
                                                            operator: -> [465,467]
                                                            name: dev [467,470]
                                return [475,489]
                                    expr [482,488]
                                        operator: - [482,483]
                                        name: EBUSY [483,488]
                expr_stmt [495,561]
                    expr [495,560]
                        name [495,512]
                            name: chip [495,499]
                            operator: -> [499,501]
                            name: data_buffer [501,512]
                        operator: = [513,514]
                        call [515,560]
                            name: kmalloc [515,522]
                            argument_list [522,560]
                                argument [523,547]
                                    expr [523,547]
                                        name: TPM_BUFSIZE [523,534]
                                        operator: * [535,536]
                                        sizeof [537,547]
                                            argument_list [543,547]
                                                argument [544,546]
                                                    expr [544,546]
                                                        name: u8 [544,546]
                                argument [549,559]
                                    expr [549,559]
                                        name: GFP_KERNEL [549,559]
                if_stmt [563,673]
                    if [563,673]
                        condition [566,593]
                            expr [567,592]
                                name [567,584]
                                    name: chip [567,571]
                                    operator: -> [571,573]
                                    name: data_buffer [573,584]
                                operator: == [585,587]
                                name: NULL [588,592]
                        block [594,673]
                            block_content [598,670]
                                expr_stmt [598,627]
                                    expr [598,626]
                                        call [598,626]
                                            name: clear_bit [598,607]
                                            argument_list [607,626]
                                                argument [608,609]
                                                    expr [608,609]
                                                        literal: 0 [608,609]
                                                argument [611,625]
                                                    expr [611,625]
                                                        operator: & [611,612]
                                                        name [612,625]
                                                            name: chip [612,616]
                                                            operator: -> [616,618]
                                                            name: is_open [618,625]
                                expr_stmt [630,652]
                                    expr [630,651]
                                        call [630,651]
                                            name: put_device [630,640]
                                            argument_list [640,651]
                                                argument [641,650]
                                                    expr [641,650]
                                                        name [641,650]
                                                            name: chip [641,645]
                                                            operator: -> [645,647]
                                                            name: dev [647,650]
                                return [655,670]
                                    expr [662,669]
                                        operator: - [662,663]
                                        name: ENOMEM [663,669]
                expr_stmt [676,711]
                    expr [676,710]
                        call [676,710]
                            name: atomic_set [676,686]
                            argument_list [686,710]
                                argument [687,706]
                                    expr [687,706]
                                        operator: & [687,688]
                                        name [688,706]
                                            name: chip [688,692]
                                            operator: -> [692,694]
                                            name: data_pending [694,706]
                                argument [708,709]
                                    expr [708,709]
                                        literal: 0 [708,709]
                expr_stmt [714,740]
                    expr [714,739]
                        name [714,732]
                            name: file [714,718]
                            operator: -> [718,720]
                            name: private_data [720,732]
                        operator: = [733,734]
                        name: chip [735,739]
                return [742,751]
                    expr [749,750]
                        literal: 0 [749,750]