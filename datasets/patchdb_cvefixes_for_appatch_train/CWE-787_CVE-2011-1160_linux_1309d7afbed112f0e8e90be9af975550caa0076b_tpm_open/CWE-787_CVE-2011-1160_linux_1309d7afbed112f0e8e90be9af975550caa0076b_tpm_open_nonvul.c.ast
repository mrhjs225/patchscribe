unit [0,0]
    function [0,740]
        type [0,3]
            name: int [0,3]
        name: tpm_open [4,12]
        parameter_list [12,52]
            parameter [13,32]
                decl [13,32]
                    type [13,32]
                        name [13,25]
                            name: struct [13,19]
                            name: inode [20,25]
                        modifier: * [26,27]
                    name: inode [27,32]
            parameter [34,51]
                decl [34,51]
                    type [34,51]
                        name [34,45]
                            name: struct [34,40]
                            name: file [41,45]
                        modifier: * [46,47]
                    name: file [47,51]
        block [53,740]
            block_content [56,738]
                decl_stmt [56,82]
                    decl [56,81]
                        type [56,59]
                            name: int [56,59]
                        name: minor [60,65]
                        init [66,81]
                            expr [68,81]
                                call [68,81]
                                    name: iminor [68,74]
                                    argument_list [74,81]
                                        argument [75,80]
                                            expr [75,80]
                                                name: inode [75,80]
                decl_stmt [84,119]
                    decl [84,112]
                        type [84,101]
                            name [84,99]
                                name: struct [84,90]
                                name: tpm_chip [91,99]
                            modifier: * [100,101]
                        name: chip [101,105]
                        init [106,112]
                            expr [108,112]
                                name: NULL [108,112]
                    decl [114,118]
                        type [84,101]
                            modifier: * [114,115]
                        name: pos [115,118]
                expr_stmt [122,138]
                    expr [122,137]
                        call [122,137]
                            name: rcu_read_lock [122,135]
                            argument_list [135,137]
                macro [140,190]
                    name: list_for_each_entry_rcu [140,163]
                    argument_list [163,190]
                        argument [164,167]
                        argument [169,183]
                        argument [185,189]
                block [191,294]
                    block_content [195,291]
                        if_stmt [195,291]
                            if [195,291]
                                condition [198,234]
                                    expr [199,233]
                                        name [199,224]
                                            name: pos [199,202]
                                            operator: -> [202,204]
                                            name: vendor [204,210]
                                            operator: . [210,211]
                                            name: miscdev [211,218]
                                            operator: . [218,219]
                                            name: minor [219,224]
                                        operator: == [225,227]
                                        name: minor [228,233]
                                block [235,291]
                                    block_content [240,287]
                                        expr_stmt [240,251]
                                            expr [240,250]
                                                name: chip [240,244]
                                                operator: = [245,246]
                                                name: pos [247,250]
                                        expr_stmt [255,277]
                                            expr [255,276]
                                                call [255,276]
                                                    name: get_device [255,265]
                                                    argument_list [265,276]
                                                        argument [266,275]
                                                            expr [266,275]
                                                                name [266,275]
                                                                    name: chip [266,270]
                                                                    operator: -> [270,272]
                                                                    name: dev [272,275]
                                        break [281,287]
                expr_stmt [296,314]
                    expr [296,313]
                        call [296,313]
                            name: rcu_read_unlock [296,311]
                            argument_list [311,313]
                if_stmt [317,345]
                    if [317,345]
                        condition [320,327]
                            expr [321,326]
                                operator: ! [321,322]
                                name: chip [322,326]
                        block [330,345]
                            block_content [330,345]
                                return [330,345]
                                    expr [337,344]
                                        operator: - [337,338]
                                        name: ENODEV [338,344]
                if_stmt [348,492]
                    if [348,492]
                        condition [351,388]
                            expr [352,387]
                                call [352,387]
                                    name: test_and_set_bit [352,368]
                                    argument_list [368,387]
                                        argument [369,370]
                                            expr [369,370]
                                                literal: 0 [369,370]
                                        argument [372,386]
                                            expr [372,386]
                                                operator: & [372,373]
                                                name [373,386]
                                                    name: chip [373,377]
                                                    operator: -> [377,379]
                                                    name: is_open [379,386]
                        block [389,492]
                            block_content [393,489]
                                expr_stmt [393,447]
                                    expr [393,446]
                                        call [393,446]
                                            name: dev_dbg [393,400]
                                            argument_list [400,446]
                                                argument [401,410]
                                                    expr [401,410]
                                                        name [401,410]
                                                            name: chip [401,405]
                                                            operator: -> [405,407]
                                                            name: dev [407,410]
                                                argument [412,445]
                                                    expr [412,445]
                                                        literal: "Another process owns this TPM\n" [412,445]
                                expr_stmt [450,472]
                                    expr [450,471]
                                        call [450,471]
                                            name: put_device [450,460]
                                            argument_list [460,471]
                                                argument [461,470]
                                                    expr [461,470]
                                                        name [461,470]
                                                            name: chip [461,465]
                                                            operator: -> [465,467]
                                                            name: dev [467,470]
                                return [475,489]
                                    expr [482,488]
                                        operator: - [482,483]
                                        name: EBUSY [483,488]
                expr_stmt [495,548]
                    expr [495,547]
                        name [495,512]
                            name: chip [495,499]
                            operator: -> [499,501]
                            name: data_buffer [501,512]
                        operator: = [513,514]
                        call [515,547]
                            name: kzalloc [515,522]
                            argument_list [522,547]
                                argument [523,534]
                                    expr [523,534]
                                        name: TPM_BUFSIZE [523,534]
                                argument [536,546]
                                    expr [536,546]
                                        name: GFP_KERNEL [536,546]
                if_stmt [550,660]
                    if [550,660]
                        condition [553,580]
                            expr [554,579]
                                name [554,571]
                                    name: chip [554,558]
                                    operator: -> [558,560]
                                    name: data_buffer [560,571]
                                operator: == [572,574]
                                name: NULL [575,579]
                        block [581,660]
                            block_content [585,657]
                                expr_stmt [585,614]
                                    expr [585,613]
                                        call [585,613]
                                            name: clear_bit [585,594]
                                            argument_list [594,613]
                                                argument [595,596]
                                                    expr [595,596]
                                                        literal: 0 [595,596]
                                                argument [598,612]
                                                    expr [598,612]
                                                        operator: & [598,599]
                                                        name [599,612]
                                                            name: chip [599,603]
                                                            operator: -> [603,605]
                                                            name: is_open [605,612]
                                expr_stmt [617,639]
                                    expr [617,638]
                                        call [617,638]
                                            name: put_device [617,627]
                                            argument_list [627,638]
                                                argument [628,637]
                                                    expr [628,637]
                                                        name [628,637]
                                                            name: chip [628,632]
                                                            operator: -> [632,634]
                                                            name: dev [634,637]
                                return [642,657]
                                    expr [649,656]
                                        operator: - [649,650]
                                        name: ENOMEM [650,656]
                expr_stmt [663,698]
                    expr [663,697]
                        call [663,697]
                            name: atomic_set [663,673]
                            argument_list [673,697]
                                argument [674,693]
                                    expr [674,693]
                                        operator: & [674,675]
                                        name [675,693]
                                            name: chip [675,679]
                                            operator: -> [679,681]
                                            name: data_pending [681,693]
                                argument [695,696]
                                    expr [695,696]
                                        literal: 0 [695,696]
                expr_stmt [701,727]
                    expr [701,726]
                        name [701,719]
                            name: file [701,705]
                            operator: -> [705,707]
                            name: private_data [707,719]
                        operator: = [720,721]
                        name: chip [722,726]
                return [729,738]
                    expr [736,737]
                        literal: 0 [736,737]